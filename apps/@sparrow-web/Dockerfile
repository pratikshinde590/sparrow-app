FROM node:20-alpine
WORKDIR /app
COPY . .
RUN yarn install

ARG PORT
ARG VITE_WEB_API_URL
ARG VITE_WEB_API_TIMEOUT
ARG VITE_WEB_ENABLE_MIX_PANEL
ARG VITE_WEB_MIX_PANEL_TOKEN
ARG VITE_WEB_SPARROW_SUPPORT_EMAIL
ARG VITE_WEB_AUTH_URL
ARG VITE_WEB_SPARROW_GITHUB
ARG VITE_WEB_SPARROW_DOWNLOAD_LINK
ARG VITE_WEB_RELEASE_NOTES_API
ARG VITE_WEB_AZURE_CDN_URL
ARG VITE_WEB_BASE_URL
ARG VITE_WEB_SPARROW_LINKEDIN
ARG VITE_WEB_AZURE_INSIGHTS_CONNECTION_STRING
ARG VITE_WEB_MARKETING_URL
ARG VITE_WEB_SPARROW_DOCS

ENV PORT=$PORT
ENV VITE_WEB_API_URL=$VITE_WEB_API_URL
ENV VITE_WEB_API_TIMEOUT=$VITE_WEB_API_TIMEOUT
ENV VITE_WEB_ENABLE_MIX_PANEL=$VITE_WEB_ENABLE_MIX_PANEL
ENV VITE_WEB_MIX_PANEL_TOKEN=$VITE_WEB_MIX_PANEL_TOKEN
ENV VITE_WEB_SPARROW_SUPPORT_EMAIL=$VITE_WEB_SPARROW_SUPPORT_EMAIL
ENV VITE_WEB_AUTH_URL=$VITE_WEB_AUTH_URL
ENV VITE_WEB_SPARROW_GITHUB=$VITE_WEB_SPARROW_GITHUB
ENV VITE_WEB_SPARROW_DOWNLOAD_LINK=$VITE_WEB_SPARROW_DOWNLOAD_LINK
ENV VITE_WEB_RELEASE_NOTES_API=$VITE_WEB_RELEASE_NOTES_API
ENV VITE_WEB_AZURE_CDN_URL=$VITE_WEB_AZURE_CDN_URL
ENV VITE_WEB_BASE_URL=$VITE_WEB_BASE_URL
ENV VITE_WEB_SPARROW_LINKEDIN=$VITE_WEB_SPARROW_LINKEDIN
ENV VITE_WEB_AZURE_INSIGHTS_CONNECTION_STRING=$VITE_WEB_AZURE_INSIGHTS_CONNECTION_STRING
ENV VITE_WEB_MARKETING_URL=$VITE_WEB_MARKETING_URL
ENV VITE_WEB_SPARROW_DOCS=$VITE_WEB_SPARROW_DOCS


EXPOSE 1422

CMD ["yarn", "web-start"]

# # Stage 1: Build the application
# FROM node:20-alpine AS builder

# # Set the working directory inside the container
# WORKDIR .

# # Copy all files to the working directory
# COPY . .

# # Install dependencies
# RUN yarn install

# # Build the project
# RUN yarn web-build

# # Stage 2: Serve the built static files
# FROM nginx:alpine

# # Copy the build files from the builder stage to Nginx's html folder
# # COPY --from=builder ./apps/@sparrow-web/dist /usr/share/nginx/html
# # COPY --from=builder ./dist /usr/share/nginx/html
# COPY --from=builder ./apps/@sparrow-web/dist /usr/share/nginx/html


# # Expose the port Nginx will serve on
# EXPOSE 1422

# # Start Nginx
# CMD ["nginx", "-g", "daemon off;"]
